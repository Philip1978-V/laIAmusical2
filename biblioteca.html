<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca de Cartas/Canciones üé∂</title>
    <style>
        /* Estilos CSS (Generales se mantienen) */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1 {
            color: #0056b3;
            text-align: center;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .search-section, .data-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #f9f9ff;
        }
        
        /* Estilos espec√≠ficos para la B√∫squeda */
        #search-input {
            width: 98%;
            padding: 12px;
            border: 2px solid #ccc;
            border-radius: 6px;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .search-results {
            margin-top: 15px;
        }
        
        .result-item {
            padding: 8px 10px;
            border-bottom: 1px dotted #ccc;
            /* El cursor pointer se quita de aqu√≠, porque ya no todo el div es clickable */
            transition: background-color 0.2s;
            border-radius: 4px;
        }
        .result-item:hover {
            background-color: #e8f4ff;
        }
        .result-item:last-child {
            border-bottom: none;
        }

        /* MODIFICADO: El t√≠tulo ahora es un enlace */
        .result-title {
            font-weight: bold;
            color: #0056b3;
            text-decoration: underline;
            cursor: pointer; /* El cursor de clic solo en el t√≠tulo */
            font-size: 1.1em;
        }
        .result-title:hover {
            color: #003a7a;
        }

        .result-sala {
            font-size: 0.9em;
            color: #6a6a6a;
            margin-top: 4px; /* Peque√±o espacio */
        }

        /* Estilos para la lista de Salas (Se mantienen) */
        #salas-container ul { list-style: none; padding: 0; }
        #salas-container li { margin: 10px 0; }
        #salas-container a {
            display: block;
            padding: 12px;
            background-color: #e9ecef;
            color: #0056b3;
            text-decoration: none;
            border-radius: 4px;
            border-left: 5px solid #007bff;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        #salas-container a:hover {
            background-color: #d6e9f8;
            border-left-color: #0056b3;
            text-decoration: none; /* Asegura que el enlace de la sala no se subraye */
        }
        .count {
            float: right;
            background-color: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        /* Bot√≥n de Men√∫ Principal (Se mantiene) */
        .back-button {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .back-button:hover { background-color: #2980b9; }


        /* --- Estilos para el Modal (Sin cambios) --- */
        .modal-backdrop {
            position: fixed; 
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.6); 
            display: none; 
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 25px;
            border: 1px solid #888;
            width: 90%;
            max-width: 700px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .modal-close {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .modal-close:hover,
        .modal-close:focus {
            color: #000;
        }
        
        #modal-body h3 {
            color: #0056b3;
            margin-top: 0;
            font-size: 1.8em;
        }
        #modal-body img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            float: left;
            margin-right: 20px;
            border-radius: 8px;
            border: 2px solid #eee;
        }
        #modal-body p {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        #modal-body .modal-meta {
            font-size: 0.95em;
            color: #555;
            clear: both; 
            padding-top: 15px;
            border-top: 1px solid #eee;
            margin-top: 15px;
            line-height: 1.7;
        }
        .modal-redirect-button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 18px;
            background-color: #28a745; 
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .modal-redirect-button:hover {
            background-color: #218838;
        }
        /* --- FIN ESTILOS MODAL --- */

    </style>
</head>
<body>

<div class="container">
    <a href="temas.html" class="back-button">‚¨ÖÔ∏è Volver al Men√∫ Principal</a>
    <h1>Biblioteca de Cartas/Canciones üé∂</h1>

    <div class="search-section">
        <h2>üîç Buscar Carta/Canci√≥n</h2>
        <input 
            type="text" 
            id="search-input" 
            placeholder="Escribe el t√≠tulo o autor para buscar en todas las salas..."
            onkeyup="buscarEntradas()">
        
        <div id="search-results-container" class="search-results">
            </div>
    </div>
    
    <div class="data-section">
        <h2>üóÇÔ∏è Biblioteca Clasificada por Salas</h2>
        <div id="salas-container">
            </div>
    </div>
    
</div>

<div id="modal-detalles" class="modal-backdrop">
    <div class="modal-content">
        <span class="modal-close" onclick="cerrarDetalles()">&times;</span>
        <div id="modal-body">
            </div>
    </div>
</div>


<script>
    // --- Configuraci√≥n de Salas (Sin cambios) ---
    const salasConfig = [
        { nombre: "Sala literaria", archivo: "sala-literaria.html" },
        { nombre: "Sala cine", archivo: "sala-cine.html" },
	    { nombre: "Sala cuentos", archivo: "sala-cuentos.html" },
        { nombre: "Sala dibujos animados", archivo: "sala-dibujos-animados.html" },
        { nombre: "Sala teatro y musicales", archivo: "sala-teatro-y-musicales.html" },
        { nombre: "Sala √≥pera y conciertos", archivo: "sala-opera-y-conciertos.html" },
        { nombre: "Sala series", archivo: "sala-series.html" },
        { nombre: "Sala anime", archivo: "sala-anime.html" },
        { nombre: "Sala amigos", archivo: "sala-amigos.html" },
        { nombre: "Sala extras", archivo: "sala-extras.html" }
    ];

    const CLAVE_LOCAL = 'bibliotecaData';

    // --- Funciones de Almacenamiento (Sin cambios) ---
    function obtenerDatos() {
        const data = localStorage.getItem(CLAVE_LOCAL);
        return data ? JSON.parse(data) : [];
    }
    
    function guardarDatos(data) {
        localStorage.setItem(CLAVE_LOCAL, JSON.stringify(data));
    }

    // --- Listas de Entradas (Sin cambios) ---
    const entradasBaseSalaLiteraria = [
        { titulo: "A una rosa", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/a_una_rosa.mp3" },
        { titulo: "Adolescencia", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/adolescencia.mp3" },
        { titulo: "Aeroplanos", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/aeroplanos.mp3" },
        { titulo: "Altazor(Canto IV)", autor: "Vicente Huidobro", sala: "sala-literaria.html", audioUrl: "audio/altazor_canto_iv.mp3" },
        { titulo: "Amor constante m√°s all√° de la muerte", autor: "Francisco de Quevedo", sala: "sala-literaria.html", audioUrl: "audio/amor_constante.mp3" },
        { titulo: "Arbol√© arbol√©", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/arbole_arbole.mp3" },
        { titulo: "Baladas y canciones del Paran√°", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/baladas_parana.mp3" },
        { titulo: "Campos de Castilla(Retrato)", autor: "Antonio Machado", sala: "sala-literaria.html", audioUrl: "audio/campos_castilla_retrato.mp3" },
        { titulo: "Canci√≥n para los ojos", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/cancion_ojos.mp3" },
        { titulo: "Cancion del Pirata", autor: "Jos√© de Espronceda", sala: "sala-literaria.html", audioUrl: "audio/cancion_pirata.mp3" },
        { titulo: "C√°ntico", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/cantico.mp3" },
        { titulo: "Columpio", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/columpio.mp3" },
        { titulo: "Contra molinos y gigantes", autor: "Cervantes", sala: "sala-literaria.html", audioUrl: "audio/molinos-gigantes.mp3" },
        { titulo: "Coraz√≥n coraza", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/corazon_coraza.mp3" },
        { titulo: "Don Quijote de la Mancha", autor: "Miguel de Cervantes", sala: "sala-literaria.html", audioUrl: "audio/lit_quijote.mp3" },
        { titulo: "El burro flautista(F√°bulas literarias)", autor: "Tom√°s de Iriarte", sala: "sala-literaria.html", audioUrl: "audio/burro_flautista.mp3" },
        { titulo: "El ciclo de Macondo", autor: "Garc√≠a M√°rquez", sala: "sala-literaria.html", audioUrl: "audio/macondo.mp3" },
        { titulo: "El lenguaje del mundo", autor: "An√≥nimo", sala: "sala-literaria.html", audioUrl: "audio/lenguaje-mundo.mp3" },
        { titulo: "El matrimonio Bennet", autor: "Jane Austen", sala: "sala-literaria.html", audioUrl: "audio/bennet.mp3" },
        { titulo: "El ojo que todo lo ve", autor: "George Orwell", sala: "sala-literaria.html", audioUrl: "audio/ojo-ve.mp3" },
        { titulo: "El remordimiento", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/el_remordimiento.mp3" },
        { titulo: "El sol, la playa y la sinceridad", autor: "Albert Camus", sala: "sala-literaria.html", audioUrl: "audio/sol-playa.mp3" },
        { titulo: "Eleg√≠a", autor: "Miguel Hernandez", sala: "sala-literaria.html", audioUrl: "audio/elegia.mp3" },
        { titulo: "Freija", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/freija.mp3" },
        { titulo: "Hija del viento", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/hija_del_viento.mp3" },
        { titulo: "Historia del caballo de √©bano", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/caballo_ebano.mp3" },
        { titulo: "Ir y quedarse", autor: "Lope de Vega", sala: "sala-literaria.html", audioUrl: "audio/ir_y_quedarse.mp3" },
        { titulo: "La fiebre de San Persburgo", autor: "Dostoyevski", sala: "sala-literaria.html", audioUrl: "audio/san-persburgo.mp3" },
        { titulo: "La hermanilla", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/la_hermanilla.mp3" },
        { titulo: "La naturaleza", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/la_naturaleza.mp3" },
        { titulo: "La patinadora", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/la_patinadora.mp3" },
        { titulo: "La princesa esta triste", autor: "Rub√©n Dar√≠o", sala: "sala-literaria.html", audioUrl: "audio/princesa_triste.mp3" },
        { titulo: "La traves√≠a de Odiseo", autor: "Homero", sala: "sala-literaria.html", audioUrl: "audio/odiseo.mp3" },
        { titulo: "La voz a t√≠ debida", autor: "Pedro Salinas", sala: "sala-literaria.html", audioUrl: "audio/la_voz_a_ti_debida.mp3" },
        { titulo: "Marinero en tierra", autor: "Rafael Alberti", sala: "sala-literaria.html", audioUrl: "audio/marinero_tierra.mp3" },
        { titulo: "Marinero en tierra(Sue√±o del marinero)", autor: "Rafael Alberti", sala: "sala-literaria.html", audioUrl: "audio/marinero_tierra_sueno.mp3" },
        { titulo: "Memorias de la melancol√≠a", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/memorias_melancolia.mp3" },
        { titulo: "Pa√≠s", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/pais.mp3" },
        { titulo: "Piedra de Sol", autor: "Octavio Paz", sala: "sala-literaria.html", audioUrl: "audio/piedra_sol.mp3" },
        { titulo: "Poeta en New York(La aurora)", autor: "Federico Garc√≠a Lorca", sala: "sala-literaria.html", audioUrl: "audio/poeta_new_york_la_aurora.mp3" },
        { titulo: "Por una mirada un mundo", autor: "Gustavo Adolfo B√©cquer", sala: "sala-literaria.html", audioUrl: "audio/por_una_mirada.mp3" },
        { titulo: "Residencia en la tierra(Barcarola)", autor: "Pablo Neruda", sala: "sala-literaria.html", audioUrl: "audio/residencia_tierra_barcarola.mp3" },
        { titulo: "Romance del Duero", autor: "Gerardo Diego", sala: "sala-literaria.html", audioUrl: "audio/romance_duero.mp3" },
        { titulo: "Romancero gitano(Romance de la luna, luna)", autor: "Federico Garc√≠a Lorca", sala: "sala-literaria.html", audioUrl: "audio/romancero_gitano_luna.mp3" },
        { titulo: "San Baudelio de Berlanga", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/san_baudelio.mp3" },
        { titulo: "Se equivoc√≥ la paloma", autor: "Rafael Alberti", sala: "sala-literaria.html", audioUrl: "audio/se_equivoco_paloma.mp3" },
        { titulo: "Si el hombre pudiera decir", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/si_el_hombre.mp3" },
        { titulo: "Trilce", autor: "C√©sar Vallejo", sala: "sala-literaria.html", audioUrl: "audio/trilce.mp3" },
        { titulo: "Veinte poemas de amor", autor: "Pablo Neruda", sala: "sala-literaria.html", audioUrl: "audio/veinte_poemas_amor.mp3" },
    ];
    
    const entradasBaseSalaLiterariaDetallada = [
        { titulo: "El lenguaje del mundo", autor: "Paulo Coelho", sala: "sala-literaria.html", year: 1988, genre: "F√°bula / Aventura", image: "imagenportada/lit_alquimista.png", description: "Basada en (El Alquimista). Santiago, un pastor andaluz, viaja a las pir√°mides de Egipto en busca de un tesoro.", audioUrl: "audio/lit_alquimista.mp3" },
        { titulo: "El ciclo de Macondo", autor: "Gabriel Garc√≠a M√°rquez", sala: "sala-literaria.html", year: 1967, genre: "Realismo M√°gico", image: "imagenportada/lit_cien_anios.png", description: "Basada en (Cien a√±os de soledad). La historia de la familia Buend√≠a a lo largo de siete generaciones en el pueblo de Macondo.", audioUrl: "audio/lit_cien_anios.mp3" },
        { titulo: "El ojo que todo lo ve", autor: "George Orwell", sala: "sala-literaria.html", year: 1949, genre: "Distop√≠a / Ciencia Ficci√≥n", image: "imagenportada/lit_1984.png", description: "Basada en (1984). Winston Smith vive en un mundo totalitario bajo la vigilancia constante del 'Gran Hermano'.", audioUrl: "audio/lit_1984.mp3" },
        { titulo: "La Fiebre de San Petersburgo", autor: "Fi√≥dor Dostoievski", sala: "sala-literaria.html", year: 1866, genre: "Novela Psicol√≥gica", image: "imagenportada/lit_crimen.png", description: "Basada en (Crimen y castigo). Un estudiante pobre, Rask√≥lnikov, comete un asesinato y lucha con su culpa.", audioUrl: "audio/lit_crimen.mp3" },
        { titulo: "El Matrimonio Bennet", autor: "Jane Austen", sala: "sala-literaria.html", year: 1813, genre: "Novela Rom√°ntica", image: "imagenportada/lit_orgullo.png", description: "Basada en (Orgullo y prejuicio). Elizabeth Bennet y el Sr. Darcy luchan contra el orgullo y los prejuicios sociales.", audioUrl: "audio/lit_orgullo.mp3" },
        { titulo: "Contra molinos y gigantes", autor: "Miguel de Cervantes", sala: "sala-literaria.html", year: 1605, genre: "Novela de Caballer√≠as / S√°tira", image: "imagenportada/lit_quijote.png", description: "Basada en (Don Quijote de la Mancha). Un hidalgo enloquece al leer libros de caballer√≠as y se lanza a la aventura como caballero andante.", audioUrl: "audio/lit_quijote.mp3" },
        { titulo: "El sol, la playa y la sinceridad", autor: "Albert Camus", sala: "sala-literaria.html", year: 1942, genre: "Novela Filos√≥fica / Existencialismo", image: "imagenportada/lit_extranjero.png", description: "Basada en (El extranjero). Meursault asiste al funeral de su madre y, poco despu√©s, comete un asesinato indiferente al sol.", audioUrl: "audio/lit_extranjero.mp3" },
        { titulo: "La traves√≠a de Odiseo", autor: "Homero", sala: "sala-literaria.html", year: "Siglo VIII a.C.", genre: "Poema √âpico", image: "imagenportada/lit_odisea.png", description: "Basada en (La Odisea). El viaje de regreso de Odiseo a √çtaca, lleno de monstruos, dioses y peligros.", audioUrl: "audio/lit_odisea.mp3" }
    ];

    const entradasBaseSalaCine = [
        { titulo: "El malet√≠n y el pasaje", autor: "Quentin Tarantino", sala: "sala-cine.html", year: 1994, genre: "Neo-noir / Crimen", image: "imagenportada/cine_pulpfiction.png", description: "Basada en (Pulp Fiction). Las vidas de dos sicarios, un boxeador, la esposa de un g√°ngster y una pareja de atracadores se entrelazan en cuatro historias de violencia y redenci√≥n.", audioUrl: "audio/cine_pulpfiction.mp3" },
        { titulo: "La oferta irrechazable", autor: "Francis Ford Coppola", sala: "sala-cine.html", year: 1972, genre: "Crimen / Drama", image: "imagenportada/cine_padrino.png", description: "Basada en (El Padrino). La cr√≥nica de la familia Corleone, una de las cinco familias que dominan la mafia en Nueva York.", audioUrl: "audio/cine_padrino.mp3" },
        { titulo: "La Conexi√≥n Cuantificable", autor: "Christopher Nolan", sala: "sala-cine.html", year: 2014, genre: "Ciencia Ficci√≥n / Aventura", image: "imagenportada/cine_interestelar.png", description: "Basada en (Interestelar). Un grupo de exploradores viaja a trav√©s de un agujero de gusano para asegurar la supervivencia de la humanidad.", audioUrl: "audio/cine_interestelar.mp3" },
        { titulo: "20 A√±os de Pico y P√≥ster", autor: "Frank Darabont", sala: "sala-cine.html", year: 1994, genre: "Drama", image: "imagenportada/cine_cadena.png", description: "Basada en (Cadena perpetua). Andy Dufresne, un banquero condenado por matar a su esposa, sobrevive y planea su fuga de la prisi√≥n de Shawshank.", audioUrl: "audio/cine_cadena.mp3" },
        { titulo: "La √öltima Superviviente", autor: "Ridley Scott", sala: "sala-cine.html", year: 1979, genre: "Ciencia Ficci√≥n / Terror", image: "imagenportada/cine_alien.png", description: "Basado en (Alien, el octavo pasajero).La tripulaci√≥n de la nave Nostromo es atacada por una forma de vida extraterrestre letal.", audioUrl: "audio/cine_alien.mp3" },
        { titulo: "¬øUn Cr√≠o? Ya Soy un Hombre", autor: "Fernando Meirelles", sala: "sala-cine.html", year: 2002, genre: "Drama / Crimen", image: "imagenportada/cine_ciudaddedios.png", description: "Basada en (Ciudad de Dios). La vida en una favela de R√≠o de Janeiro a trav√©s de los ojos de Rocket, un joven que busca ser fot√≥grafo.", audioUrl: "audio/cine_ciudaddedios.mp3" },
        { titulo: "Un hogar", autor: "Steven Spielberg", sala: "sala-cine.html", year: 1982, genre: "Ciencia Ficci√≥n / Familiar", image: "imagenportada/cine_et.png", description: "Basada en (E.T. El Extraterrestre). Un ni√±o solitario se hace amigo de un extraterrestre abandonado, y juntos intentan encontrar una forma de volver a casa.", audioUrl: "audio/cine_et.mp3" },
        { titulo: "No Olvides Tu Nombre", autor: "Hayao Miyazaki", sala: "sala-cine.html", year: 2001, genre: "Animaci√≥n / Fantas√≠a", image: "imagenportada/cine_chihiro.png", description: "Basado en (El viaje de Chihiro). Una ni√±a de 10 a√±os se aventura en un mundo de esp√≠ritus para salvar a sus padres, que han sido convertidos en cerdos.", audioUrl: "audio/cine_chihiro.mp3" }
    ];

    // --- Mapa Centralizado (Sin cambios) ---
    const todasLasEntradasBase = {
        "sala-literaria.html": [
            ...entradasBaseSalaLiteraria,           
            ...entradasBaseSalaLiterariaDetallada   
        ],
        "sala-cine.html": entradasBaseSalaCine, 
    };

    // --- Funciones de Inicializaci√≥n (Sin cambios) ---
    function inicializarDatosSala(archivoSala, datosExistentes) {
        const entradasBase = todasLasEntradasBase[archivoSala];
        if (!entradasBase) return datosExistentes; 

        let datos = [...datosExistentes];
        let datosModificados = false;

        datos = datos.filter(d => 
            d.sala !== archivoSala || entradasBase.some(base => 
                base.titulo === d.titulo && base.autor === d.autor
            )
        );

        entradasBase.forEach(entradaBase => {
            const yaExiste = datos.some(d => 
                d.titulo === entradaBase.titulo && d.autor === entradaBase.autor && d.sala === entradaBase.sala
            );
            if (!yaExiste) {
                datos.push(entradaBase);
                datosModificados = true;
            } else {
                const index = datos.findIndex(d => d.titulo === entradaBase.titulo && d.autor === entradaBase.autor);
                if (index !== -1 && entradaBase.description && !datos[index].description) {
                    datos[index] = entradaBase; 
                    datosModificados = true;
                }
            }
        });

        if (datosModificados) {
            guardarDatos(datos);
        }
        return datos;
    }
    
    function forzarInicializacionYObtenerDatos() {
        let datos = obtenerDatos();
        for (const archivoSala in todasLasEntradasBase) {
            datos = inicializarDatosSala(archivoSala, datos); 
        }
        return datos;
    }


    // --- Funciones del Modal (Sin cambios) ---
    function mostrarDetalles(entrada) {
        const modalBody = document.getElementById('modal-body');
        const salaInfo = salasConfig.find(s => s.archivo === entrada.sala);
        const salaNombre = salaInfo ? salaInfo.nombre : 'Sala desconocida';
        
        let imagenHtml = '';
        if (entrada.image) {
            imagenHtml = `<img src="${entrada.image}" alt="${entrada.titulo}">`;
        }

        modalBody.innerHTML = `
            ${imagenHtml}
            <h3>${entrada.titulo}</h3>
            <p>${entrada.description || 'No hay descripci√≥n disponible.'}</p>
            
            <div class="modal-meta">
                <strong>Autor:</strong> ${entrada.autor || 'Desconocido'}<br>
                ${entrada.year ? `<strong>A√±o:</strong> ${entrada.year}<br>` : ''}
                ${entrada.genre ? `<strong>G√©nero:</strong> ${entrada.genre}<br>` : ''}
                <strong>Clasificado en:</strong> ${salaNombre}
            </div>
            
            <a href="${entrada.sala}" class="modal-redirect-button">
                Ir a la ${salaNombre} ‚û°Ô∏è
            </a>
        `;
        
        document.getElementById('modal-detalles').style.display = 'flex';
    }

    function cerrarDetalles() {
        document.getElementById('modal-detalles').style.display = 'none';
    }
    

    // --- üîÑ FUNCI√ìN DE B√öSQUEDA (ACTUALIZADA) ---
    function buscarEntradas() {
        const query = document.getElementById('search-input').value.toLowerCase().trim();
        const resultsContainer = document.getElementById('search-results-container');
        resultsContainer.innerHTML = '';

        if (query.length < 3) {
            resultsContainer.innerHTML = '<p style="color: #999;">Escribe al menos 3 caracteres para iniciar la b√∫squeda.</p>';
            return;
        }

        const datos = forzarInicializacionYObtenerDatos();
        const salasExistentes = salasConfig.map(s => s.archivo);

        // 1. Filtrar resultados (Sin cambios)
        const resultadosUnicos = {};
        datos.forEach(entrada => {
            if (
                (entrada.titulo.toLowerCase().includes(query) || entrada.autor.toLowerCase().includes(query)) &&
                salasExistentes.includes(entrada.sala)
            ) {
                const claveUnica = `${entrada.titulo}|${entrada.autor}`;
                if (!resultadosUnicos[claveUnica] || (entrada.description && !resultadosUnicos[claveUnica].description)) {
                    resultadosUnicos[claveUnica] = entrada;
                }
            }
        });
        
        const resultadosFinales = Object.values(resultadosUnicos);

        if (resultadosFinales.length === 0) {
            resultsContainer.innerHTML = '<p style="color: red;">‚ùå No se encontraron resultados que coincidan.</p>';
            return;
        }
        
        // 2. Mostrar los resultados (MODIFICADO para crear elementos program√°ticamente)
        resultadosFinales.forEach(entrada => {
            const salaInfo = salasConfig.find(s => s.archivo === entrada.sala);
            const salaNombre = salaInfo ? salaInfo.nombre : 'Error de Sala';
            
            // Creamos los elementos en lugar de usar innerHTML
            const itemDiv = document.createElement('div');
            itemDiv.className = 'result-item';

            // Creamos el enlace del t√≠tulo
            const titleLink = document.createElement('a');
            titleLink.className = 'result-title';
            titleLink.textContent = entrada.titulo;

            // Creamos el texto de meta-informaci√≥n
            const metaDiv = document.createElement('div');
            metaDiv.className = 'result-sala';
            // Quitamos los asteriscos (**) que no son HTML
            metaDiv.textContent = `Autor: ${entrada.autor} | Clasificado en: ${salaNombre}`; 

            // --- A√ëADIMOS LA L√ìGICA DE CLIC AL ENLACE ---
            if (entrada.description) {
                // CASO 1: Es una entrada detallada -> Mostrar Modal
                titleLink.title = "Haz clic para ver m√°s detalles";
                titleLink.href = "#"; // Es un enlace de marcador
                titleLink.addEventListener('click', function(e) {
                    e.preventDefault(); // Evita que la p√°gina salte al inicio por el '#'
                    mostrarDetalles(entrada);
                });
            } else {
                // CASO 2: Es una entrada simple -> Redireccionar
                titleLink.title = `Haz clic para ir a la ${salaNombre}`;
                titleLink.href = entrada.sala; // El enlace es la URL de la sala
                // No se necesita event listener, el 'href' hace el trabajo.
            }
            
            // A√±adimos los elementos al contenedor
            itemDiv.appendChild(titleLink);
            itemDiv.appendChild(metaDiv);
            resultsContainer.appendChild(itemDiv);
        });

        resultsContainer.innerHTML += `<p style="font-size: 0.9em; margin-top: 10px;">Encontrados ${resultadosFinales.length} resultados.</p>`;
    }


    // --- FUNCI√ìN PARA MOSTRAR LOS ENLACES (Sin cambios) ---
    function mostrarSalas() {
        const container = document.getElementById('salas-container');
        container.innerHTML = '';
        
        const datos = forzarInicializacionYObtenerDatos(); 
        
        const ul = document.createElement('ul');

        const counts = datos.reduce((acc, entrada) => {
            acc[entrada.sala] = (acc[entrada.sala] || 0) + 1;
            return acc;
        }, {});

        salasConfig.forEach(sala => {
            const count = counts[sala.archivo] || 0;
            const li = document.createElement('li');
            li.innerHTML = `
                <a href="${sala.archivo}">
                    ${sala.nombre}
                    <span class="count">${count}</span>
                </a>
            `;
            ul.appendChild(li);
        });

        container.appendChild(ul);
    }

    // --- Carga inicial y cierre de modal (Sin cambios) ---
    window.onload = mostrarSalas;

    window.onclick = function(event) {
        const modal = document.getElementById('modal-detalles');
        if (event.target == modal) {
            cerrarDetalles();
        }
    }
</script>

</body>
</html>