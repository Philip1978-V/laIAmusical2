<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca de Cartas/Canciones üé∂</title>
    <style>
        /* Estilos CSS (Generales) */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* Contenedor de Cabecera para el t√≠tulo y el bot√≥n */
        .header-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #0056b3;
            text-align: center;
            flex-grow: 1; /* Permite que el t√≠tulo ocupe el espacio central */
            margin: 0;
            padding-left: 10px; /* Peque√±o ajuste para centrar visualmente mejor */
        }
        
        /* Estilos del Bot√≥n "Men√∫ principal" */
        #menu-principal-btn {
            background-color: #a4b953; /* Verde/Amarillento */
            color: white;
            border: none;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: background-color 0.2s, transform 0.1s;
        }
        
        #menu-principal-btn:hover {
            background-color: #8c9e47; /* Tono m√°s oscuro al pasar el rat√≥n */
            transform: translateY(-1px);
        }

        .search-section, .data-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #f9f9ff;
        }
        
        /* Estilos espec√≠ficos para la B√∫squeda */
        #search-input {
            width: 98%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .search-results {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 4px;
            background-color: #fff;
        }
        .result-item {
            padding: 8px;
            border-bottom: 1px dashed #eee;
            cursor: pointer; /* Indica que es clicable */
            transition: background-color 0.1s;
        }
        .result-item:hover {
            background-color: #e6f0ff;
        }
        .result-title {
            font-weight: bold;
            color: #0056b3;
        }
        .result-sala {
            font-size: 0.85em;
            color: #666;
            margin-top: 2px;
        }
        
        /* Estilos para la secci√≥n de Salas */
        #salas-container ul {
            list-style: none;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        #salas-container li {
            background-color: #e6f0ff;
            border: 1px solid #0056b3;
            border-radius: 5px;
            padding: 10px 15px;
            transition: background-color 0.2s, transform 0.2s;
        }
        #salas-container li:hover {
            background-color: #cce0ff;
            transform: translateY(-2px);
        }
        #salas-container a {
            text-decoration: none;
            color: #0056b3;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .count {
            background-color: #0056b3;
            color: white;
            padding: 3px 8px;
            border-radius: 50px;
            font-size: 0.8em;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="header-wrapper">
        <button id="menu-principal-btn" onclick="window.location.href='index.html'">Men√∫ principal</button>
        <h1>Biblioteca de Cartas/Canciones üé∂</h1>
    </div>
    
    <p style="text-align: center; margin-bottom: 20px;">
        Aqu√≠ puedes ver todas las cartas/canciones disponibles en las distintas salas.
    </p>

    <div class="search-section">
        <h2>üîç Buscar Carta/Canci√≥n</h2>
        <input type="text" id="search-input" placeholder="Escribe el t√≠tulo, autor o sala para buscar..." onkeyup="buscarEntradas()">
        <div id="search-results" class="search-results">
            <p style="text-align: center; color: #999;">Empieza a escribir para ver los resultados.</p>
        </div>
    </div>

    <div class="data-section">
        <h2>üö™ Salas Disponibles</h2>
        <div id="salas-container">
            </div>
        <p style="text-align: center; font-size: 0.9em; margin-top: 15px;">
            Haz clic en una sala para ver el listado completo y gestionar las compras/reproducciones.
        </p>
    </div>
</div>

<script>
    // --- CONSTANTES GLOBALES ---
    const CLAVE_LOCAL = "bibliotecaData";
    
    // Configuraci√≥n de las salas
    const salasConfig = [
        { archivo: 'sala-literaria.html', nombre: 'Sala Literaria üìö' },
        { archivo: 'sala-cine.html', nombre: 'Sala de Cine üé¨' }, 
        // A√±ade otras salas aqu√≠ a medida que las crees
    ];

    // --- DATOS BASE SIMULADOS DE OTRAS SALAS (ACTUALIZADOS CON originalObra) ---
    
    // 1. Datos Base de sala-literaria.html (50 entradas)
    const entradasBase_Literaria = [
        { titulo: "A una rosa", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/a_una_rosa.mp3", originalObra: "Soneto (Varios autores)" },
        { titulo: "Adolescencia", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/adolescencia.mp3", originalObra: "Poema l√≠rico" },
        { titulo: "Aeroplanos", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/aeroplanos.mp3", originalObra: "Poema" },
        { titulo: "Altazor(Canto IV)", autor: "Vicente Huidobro", sala: "sala-literaria.html", audioUrl: "audio/altazor_canto_iv.mp3", originalObra: "Altazor o el viaje en paraca√≠das" },
        { titulo: "Amor constante m√°s all√° de la muerte", autor: "Francisco de Quevedo", sala: "sala-literaria.html", audioUrl: "audio/amor_constante.mp3", originalObra: "Poema (Soneto)" },
        { titulo: "Arbol√© arbol√©", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/arbole_arbole.mp3", originalObra: "Poema l√≠rico" },
        { titulo: "Baladas y canciones del Paran√°", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/baladas_parana.mp3", originalObra: "Obra po√©tica" },
        { titulo: "Campos de Castilla(Retrato)", autor: "Antonio Machado", sala: "sala-literaria.html", audioUrl: "audio/campos_castilla_retrato.mp3", originalObra: "Campos de Castilla" },
        { titulo: "Canci√≥n para los ojos", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/cancion_ojos.mp3", originalObra: "Poema" },
        { titulo: "Cancion del Pirata", autor: "Jos√© de Espronceda", sala: "sala-literaria.html", audioUrl: "audio/cancion_pirata.mp3", originalObra: "Canci√≥n del Pirata (Poema)" },
        { titulo: "C√°ntico", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/cantico.mp3", originalObra: "Obra po√©tica (Varios autores)" },
        { titulo: "Columpio", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/columpio.mp3", originalObra: "Poema" },
        { titulo: "Contra molinos y gigantes", autor: "Cervantes", sala: "sala-literaria.html", audioUrl: "audio/molinos-gigantes.mp3", originalObra: "Don Quijote de la Mancha" },
        { titulo: "Coraz√≥n coraza", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/corazon_coraza.mp3", originalObra: "Poema" },
        { titulo: "Don Quijote de la Mancha", autor: "Miguel de Cervantes", sala: "sala-literaria.html", audioUrl: "audio/lit_quijote.mp3", originalObra: "El ingenioso hidalgo Don Quijote de la Mancha" },
        { titulo: "El burro flautista(F√°bulas literarias)", autor: "Tom√°s de Iriarte", sala: "sala-literaria.html", audioUrl: "audio/burro_flautista.mp3", originalObra: "F√°bulas literarias" },
        { titulo: "El ciclo de Macondo", autor: "Garc√≠a M√°rquez", sala: "sala-literaria.html", audioUrl: "audio/macondo.mp3", originalObra: "Cien a√±os de soledad" },
        { titulo: "El lenguaje del mundo", autor: "An√≥nimo", sala: "sala-literaria.html", audioUrl: "audio/lenguaje-mundo.mp3", originalObra: "Cuento tradicional" },
        { titulo: "El matrimonio Bennet", autor: "Jane Austen", sala: "sala-literaria.html", audioUrl: "audio/bennet.mp3", originalObra: "Orgullo y prejuicio" },
        { titulo: "El ojo que todo lo ve", autor: "George Orwell", sala: "sala-literaria.html", audioUrl: "audio/ojo-ve.mp3", originalObra: "1984" },
        { titulo: "El remordimiento", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/el_remordimiento.mp3", originalObra: "Poema" },
        { titulo: "El sol, la playa y la sinceridad", autor: "Albert Camus", sala: "sala-literaria.html", audioUrl: "audio/sol-playa.mp3", originalObra: "El extranjero" },
        { titulo: "Eleg√≠a", autor: "Miguel Hernandez", sala: "sala-literaria.html", audioUrl: "audio/elegia.mp3", originalObra: "Eleg√≠a a Ram√≥n Sij√©" },
        { titulo: "Freija", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/freija.mp3", originalObra: "Poema l√≠rico" },
        { titulo: "Hija del viento", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/hija_del_viento.mp3", originalObra: "Poema" },
        { titulo: "Historia del caballo de √©bano", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/caballo_ebano.mp3", originalObra: "Las mil y una noches" },
        { titulo: "Ir y quedarse", autor: "Lope de Vega", sala: "sala-literaria.html", audioUrl: "audio/ir_y_quedarse.mp3", originalObra: "Soneto LXXXVI" },
        { titulo: "La fiebre de San Persburgo", autor: "Dostoyevski", sala: "sala-literaria.html", audioUrl: "audio/san-persburgo.mp3", originalObra: "Crimen y Castigo" },
        { titulo: "La hermanilla", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/la_hermanilla.mp3", originalObra: "Poema" },
        { titulo: "La naturaleza", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/la_naturaleza.mp3", originalObra: "Poema l√≠rico" },
        { titulo: "La patinadora", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/la_patinadora.mp3", originalObra: "Poema" },
        { titulo: "La princesa esta triste", autor: "Rub√©n Dar√≠o", sala: "sala-literaria.html", audioUrl: "audio/princesa_triste.mp3", originalObra: "Prosas profanas" },
        { titulo: "La traves√≠a de Odiseo", autor: "Homero", sala: "sala-literaria.html", audioUrl: "audio/odiseo.mp3", originalObra: "La Odisea" },
        { titulo: "La voz a t√≠ debida", autor: "Pedro Salinas", sala: "sala-literaria.html", audioUrl: "audio/la_voz_a_ti_debida.mp3", originalObra: "La voz a ti debida" },
        { titulo: "Marinero en tierra", autor: "Rafael Alberti", sala: "sala-literaria.html", audioUrl: "audio/marinero_tierra.mp3", originalObra: "Marinero en tierra" },
        { titulo: "Marinero en tierra(Sue√±o del marinero)", autor: "Rafael Alberti", sala: "sala-literaria.html", audioUrl: "audio/marinero_tierra_sueno.mp3", originalObra: "Marinero en tierra" },
        { titulo: "Memorias de la melancol√≠a", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/memorias_melancolia.mp3", originalObra: "Poema" },
        { titulo: "Pa√≠s", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/pais.mp3", originalObra: "Poema" },
        { titulo: "Piedra de Sol", autor: "Octavio Paz", sala: "sala-literaria.html", audioUrl: "audio/piedra_sol.mp3", originalObra: "Piedra de Sol" },
        { titulo: "Poeta en New York(La aurora)", autor: "Federico Garc√≠a Lorca", sala: "sala-literaria.html", audioUrl: "audio/poeta_new_york_la_aurora.mp3", originalObra: "Poeta en Nueva York" },
        { titulo: "Por una mirada un mundo", autor: "Gustavo Adolfo B√©cquer", sala: "sala-literaria.html", audioUrl: "audio/por_una_mirada.mp3", originalObra: "Rima IV" },
        { titulo: "Residencia en la tierra(Barcarola)", autor: "Pablo Neruda", sala: "sala-literaria.html", audioUrl: "audio/residencia_tierra_barcarola.mp3", originalObra: "Residencia en la Tierra" },
        { titulo: "Romance del Duero", autor: "Gerardo Diego", sala: "sala-literaria.html", audioUrl: "audio/romance_duero.mp3", originalObra: "Soria" },
        { titulo: "Romancero gitano(Romance de la luna, luna)", autor: "Federico Garc√≠a Lorca", sala: "sala-literaria.html", audioUrl: "audio/romancero_gitano_luna.mp3", originalObra: "Romancero gitano" },
        { titulo: "San Baudelio de Berlanga", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/san_baudelio.mp3", originalObra: "Poema" },
        { titulo: "Se equivoc√≥ la paloma", autor: "Rafael Alberti", sala: "sala-literaria.html", audioUrl: "audio/se_equivoco_paloma.mp3", originalObra: "Poema" },
        { titulo: "Si el hombre pudiera decir", autor: "Desconocido", sala: "sala-literaria.html", audioUrl: "audio/si_el_hombre.mp3", originalObra: "Poema" },
        { titulo: "Trilce", autor: "C√©sar Vallejo", sala: "sala-literaria.html", audioUrl: "audio/trilce.mp3", originalObra: "Trilce" },
        { titulo: "Veinte poemas de amor", autor: "Pablo Neruda", sala: "sala-literaria.html", audioUrl: "audio/veinte_poemas_amor.mp3", originalObra: "Veinte poemas de amor y una canci√≥n desesperada" },
    ];
    
    // 2. Datos Base de sala-cine.html (27 entradas)
    const entradasBase_Cine = [
        { titulo: "1,21 gigabatios", autor: "Robert Zemeckis", sala: "sala-cine.html", audioUrl: "audio/cine_121gigabatios.mp3", originalObra: "Regreso al Futuro" },
        { titulo: "¬øUn Cr√≠o? Ya Soy un Hombre", autor: "Fernando Meirelles", sala: "sala-cine.html", audioUrl: "audio/cine_uncrio.mp3", originalObra: "Ciudad de Dios" },
        { titulo: "Ciudad de ceniza y de Ne√≥n", autor: "Ridley Scott", sala: "sala-cine.html", audioUrl: "audio/cine_ciudadceniza.mp3", originalObra: "Blade Runner" },
        { titulo: "Deber√≠a estar en un museo", autor: "Steven Spielberg", sala: "sala-cine.html", audioUrl: "audio/cine_museo.mp3", originalObra: "Indiana Jones y la √öltima Cruzada" },
        { titulo: "El elegido", autor: "Hermanas Wachowski", sala: "sala-cine.html", audioUrl: "audio/cine_elegido.mp3", originalObra: "The Matrix" },
        { titulo: "El malet√≠n y el pasaje", autor: "Quentin Tarantino", sala: "sala-cine.html", audioUrl: "audio/cine_pulpfiction.mp3", originalObra: "Pulp Fiction" },
        { titulo: "El Ada azul y mil a√±os", autor: "Steven Spielberg", sala: "sala-cine.html", audioUrl: "audio/cine_adaazul.mp3", originalObra: "A.I. Inteligencia Artificial" },
        { titulo: "Houston tenemos un problema", autor: "Ron Howard", sala: "sala-cine.html", audioUrl: "audio/cine_houston.mp3", originalObra: "Apollo 13" },
        { titulo: "identidad borrada", autor: "Varios Directores", sala: "sala-cine.html", audioUrl: "audio/cine_identidad.mp3", originalObra: "Bourne Identity" },
        { titulo: "La Conexi√≥n Cuantificable", autor: "Christopher Nolan", sala: "sala-cine.html", audioUrl: "audio/cine_conexion.mp3", originalObra: "Interstellar" },
        { titulo: "La isla Nublar", autor: "Steven Spielberg", sala: "sala-cine.html", audioUrl: "audio/cine_nublar.mp3", originalObra: "Parque Jur√°sico" },
        { titulo: "La oferta irrechazable", autor: "Francis Ford Coppola", sala: "sala-cine.html", audioUrl: "audio/cine_oferta.mp3", originalObra: "El Padrino" },
        { titulo: "La √∫ltima superviviente", autor: "Ridley Scott", sala: "sala-cine.html", audioUrl: "audio/cine_superviviente.mp3", originalObra: "Alien: El Octavo Pasajero" },
        { titulo: "la canci√≥n de la corona y el invierno", autor: "D. & D. (Game of Thrones)", sala: "sala-cine.html", audioUrl: "audio/cine_cancioncorona.mp3", originalObra: "Juego de Tronos (Serie/Libros)" },
        { titulo: "Me llamo Bond, James Bond", autor: "Varios Autores", sala: "sala-cine.html", audioUrl: "audio/cine_bond.mp3", originalObra: "007 Saga" },
        { titulo: "Mi tesoro", autor: "Peter Jackson", sala: "sala-cine.html", audioUrl: "audio/cine_mitesoro.mp3", originalObra: "El Se√±or de los Anillos: Las Dos Torres" },
        { titulo: "Misi√≥n conseguida", autor: "Varios Directores", sala: "sala-cine.html", audioUrl: "audio/cine_mision.mp3", originalObra: "Misi√≥n Imposible Saga" },
        { titulo: "No olvides tu nombre", autor: "Hayao Miyazaki", sala: "sala-cine.html", audioUrl: "audio/cine_noolvides.mp3", originalObra: "El Viaje de Chihiro" },
        { titulo: "No... I'm your father", autor: "George Lucas", sala: "sala-cine.html", audioUrl: "audio/cine_vader.mp3", originalObra: "Star Wars: Episodio V - El Imperio Contraataca" },
        { titulo: "Noche de Cristal", autor: "Steven Spielberg", sala: "sala-cine.html", audioUrl: "audio/cine_nochecristal.mp3", originalObra: "La lista de Schindler" },
        { titulo: "Que la fuerza te acompa√±e.", autor: "George Lucas", sala: "sala-cine.html", audioUrl: "audio/cine_fuerza.mp3", originalObra: "Star Wars: Episodio IV - Una Nueva Esperanza" },
        { titulo: "Sayonara Baby", autor: "James Cameron", sala: "sala-cine.html", audioUrl: "audio/cine_sayonara.mp3", originalObra: "Terminator 2: El Juicio Final" },
        { titulo: "Soy el rey del mundo", autor: "James Cameron", sala: "sala-cine.html", audioUrl: "audio/cine_rey.mp3", originalObra: "Titanic" },
        { titulo: "The Wire Fence", autor: "Autor Desconocido", sala: "sala-cine.html", audioUrl: "audio/cine_wirefence.mp3", originalObra: "Pel√≠cula/Serie de Drama" },
        { titulo: "Un hogar", autor: "Steven Spielberg", sala: "sala-cine.html", audioUrl: "audio/cine_hogar.mp3", originalObra: "E.T. El Extraterrestre" },
        { titulo: "Veinte a√±os de pico y poster", autor: "Frank Darabont", sala: "sala-cine.html", audioUrl: "audio/cine_veinteanios.mp3", originalObra: "Cadena Perpetua" },
        { titulo: "Volver√©", autor: "James Cameron", sala: "sala-cine.html", audioUrl: "audio/cine_volvere.mp3", originalObra: "Terminator" }
    ];

    // --- FUNCIONES DE GESTI√ìN DE DATOS ---

    function obtenerDatos() {
        const data = localStorage.getItem(CLAVE_LOCAL);
        return data ? JSON.parse(data) : [];
    }

    function guardarDatos(data) {
        localStorage.setItem(CLAVE_LOCAL, JSON.stringify(data));
    }
    
    function inicializarSala(datosExistentes, entradasBase, archivoSala) {
        let datos = [...datosExistentes];
        let existeCambio = false;

        // 1. Limpiar entradas obsoletas y asegurar que solo existen entradas de esta sala
        datos = datos.filter(d => 
            d.sala !== archivoSala || entradasBase.some(base => 
                base.titulo === d.titulo && base.autor === d.autor
            )
        );

        // 2. A√±adir nuevas entradas/actualizar metadatos de esta sala
        entradasBase.forEach(entradaBase => {
            const yaExiste = datos.some(d => 
                d.titulo === entradaBase.titulo && d.autor === entradaBase.autor && d.sala === entradaBase.sala
            );
            
            if (!yaExiste) {
                datos.push(entradaBase);
                existeCambio = true;
            } else {
                // Actualizar posibles campos nuevos (como audioUrl u originalObra) si no existen
                const index = datos.findIndex(d => d.titulo === entradaBase.titulo && d.autor === entradaBase.autor && d.sala === entradaBase.sala);
                if (index !== -1) {
                    if (datos[index].audioUrl !== entradaBase.audioUrl || datos[index].originalObra !== entradaBase.originalObra) {
                        datos[index].audioUrl = entradaBase.audioUrl;
                        datos[index].originalObra = entradaBase.originalObra; // Asegura que el nuevo campo se copie
                        existeCambio = true;
                    }
                }
            }
        });

        return { datos: datos, cambio: existeCambio };
    }

    // Asegura que los datos de TODAS las salas est√©n en el localStorage
    function forzarInicializacionYObtenerDatos() {
        let datos = obtenerDatos();
        let cambioGlobal = false;
        
        // Inicializar Sala Literaria
        let resLit = inicializarSala(datos, entradasBase_Literaria, 'sala-literaria.html');
        datos = resLit.datos;
        if (resLit.cambio) {
            cambioGlobal = true;
        }

        // Inicializar Sala Cine
        let resCine = inicializarSala(datos, entradasBase_Cine, 'sala-cine.html');
        datos = resCine.datos;
        if (resCine.cambio) {
            cambioGlobal = true;
        }
        
        if (cambioGlobal) {
            guardarDatos(datos);
        }
        
        return datos;
    }

    // --- FUNCIONES DE B√öSQUEDA ---

    function buscarEntradas() {
        const input = document.getElementById('search-input');
        const query = input.value.toLowerCase().trim();
        const resultsContainer = document.getElementById('search-results');
        
        const todosLosDatos = forzarInicializacionYObtenerDatos();

        if (query.length < 3) {
            resultsContainer.innerHTML = '<p style="text-align: center; color: #999;">Empieza a escribir para ver los resultados.</p>';
            return;
        }

        const resultados = todosLosDatos.filter(entrada =>
            entrada.titulo.toLowerCase().includes(query) ||
            entrada.autor.toLowerCase().includes(query) ||
            getSalaName(entrada.sala).toLowerCase().includes(query)
        );

        // Eliminar Duplicados
        const resultadosSinDuplicados = [];
        const seenKeys = new Set(); 

        resultados.forEach(entrada => {
            // Clave √∫nica basada en t√≠tulo y autor
            const key = `${entrada.titulo}|${entrada.autor}`; 
            
            if (!seenKeys.has(key)) {
                resultadosSinDuplicados.push(entrada);
                seenKeys.add(key);
            }
        });

        mostrarResultados(resultadosSinDuplicados);
    }
    
    function getSalaName(archivo) {
        const sala = salasConfig.find(s => s.archivo === archivo);
        return sala ? sala.nombre : archivo; 
    }

    function mostrarResultados(resultados) {
        const resultsContainer = document.getElementById('search-results');
        resultsContainer.innerHTML = '';

        if (resultados.length === 0) {
            resultsContainer.innerHTML = '<p style="text-align: center; color: #999;">No se encontraron resultados.</p>';
            return;
        }

        const resultadosFinales = resultados.sort((a, b) => a.titulo.localeCompare(b.titulo));

        resultadosFinales.forEach(entrada => {
            const salaNombre = getSalaName(entrada.sala);
            const itemDiv = document.createElement('div');
            itemDiv.className = 'result-item';
            
            // Generamos el contenido HTML
            itemDiv.innerHTML = `
                <div class="result-title">${entrada.titulo}</div>
                <div class="result-sala">Autor: ${entrada.autor} | Clasificado en: <strong>${salaNombre}</strong></div>
            `;
            
            // L√≥gica de Redirecci√≥n (al hacer clic en el resultado del buscador)
            // FIX: Usamos setAttribute para asignar el evento onclick de forma expl√≠cita y robusta.
            itemDiv.setAttribute('onclick', `redirigirASala('${entrada.sala}')`);

            resultsContainer.appendChild(itemDiv);
        });

        resultsContainer.innerHTML += `<p style="font-size: 0.9em; margin-top: 10px;">Encontrados ${resultadosFinales.length} resultados.</p>`;
    }


    // --- FUNCI√ìN DE REDIRECCI√ìN ---
    function redirigirASala(archivoSala) {
        window.location.href = archivoSala;
    }


    // --- FUNCI√ìN PARA MOSTRAR LOS ENLACES ---
    function mostrarSalas() {
        const container = document.getElementById('salas-container');
        container.innerHTML = '';
        
        const datos = forzarInicializacionYObtenerDatos(); 
        
        const ul = document.createElement('ul');

        // Calcular cu√°ntas entradas hay por cada archivo (sala)
        const counts = datos.reduce((acc, entrada) => {
            acc[entrada.sala] = (acc[entrada.sala] || 0) + 1;
            return acc;
        }, {});

        // Generar los enlaces 
        salasConfig.forEach(sala => {
            const count = counts[sala.archivo] || 0;
            const li = document.createElement('li');
            li.innerHTML = `
                <a href="${sala.archivo}">
                    ${sala.nombre}
                    <span class="count">${count}</span>
                </a>
            `;
            ul.appendChild(li);
        });

        container.appendChild(ul);
    }

    // --- Carga inicial ---
    window.onload = mostrarSalas;

</script>

</body>
</html>