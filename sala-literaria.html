<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sala Literaria üìö</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 

<style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f8f8;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #A0522D;
            text-align: center;
            border-bottom: 2px solid #A0522D;
            padding-bottom: 10px;
        }
        
        /* Contenedor para los enlaces de cabecera */
        .header-links {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .back-link { 
            display: inline-block; 
            text-decoration: none; 
            color: #007bff; 
            font-weight: bold;
        }

        /* ESTILO DEL NUEVO BOT√ìN A TEMAS.HTML */
        .temas-btn {
            background-color: #BEF264; /* Verde/amarillento */
            color: #1a1a1a;
            padding: 8px 12px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            border: 1px solid #a7e555;
            transition: background-color 0.2s;
        }

        .temas-btn:hover {
            background-color: #d2f99a; 
        }

        /* --- Estilos para la Lista de Canciones/Cartas --- */
        #lista-entradas {
            padding: 1px 0; 
        }

        .entrada-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px;
            margin: 5px 0;
            border-bottom: 1px solid #eee; 
            cursor: default; 
            background-color: #fff;
            transition: background-color 0.2s;
        }
        .entrada-item:hover {
            background-color: #f7f7f7;
        }
        .titulo-autor {
            flex-grow: 1;
            margin-right: 15px; 
            min-width: 250px;
        }
        .titulo {
            font-weight: bold;
            color: #333;
        }
        .autor {
            font-size: 0.9em;
            color: #666;
        }
        /* Nuevo estilo para la Obra Original */
        .original-obra {
            font-size: 0.85em;
            color: #8B4513; /* Tono marr√≥n para la literatura */
            margin-top: 2px;
            font-style: italic;
        }


        /* --- Controles de Audio y Compra --- */
        .controles-audio {
            display: flex;
            gap: 10px;
        }
        audio { display: none; }
        .control-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            font-size: 1.2em;
            color: #A0522D;
            transition: color 0.2s;
        }
        .control-btn:hover {
            color: #D2B48C;
        }
        
        .controles-compra {
            display: flex;
            gap: 5px;
            margin-left: 15px;
        }
        
        .buy-btn, .lyrics-btn {
            background: #D2B48C; 
            color: #333;
            border: none;
            padding: 8px 10px;
            font-size: 0.8em;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            white-space: nowrap; 
            font-weight: bold;
            display: flex; 
            align-items: center; 
            gap: 4px; 
        }
        .lyrics-btn {
            background: #A0522D; 
            color: white;
        }
        .buy-btn:hover:not(:disabled), .lyrics-btn:hover:not(:disabled) {
            opacity: 0.9;
        }
        .buy-btn:disabled, .lyrics-btn:disabled {
            background-color: #ccc;
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* --- Estilos para la ventana modal --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.4); 
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 80%; 
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        #modal-title {
            color: #A0522D;
            margin-top: 0;
        }
        #modal-message {
            margin-bottom: 20px;
            color: #666;
            font-weight: bold;
        }
        .modal-buttons {
            text-align: right;
        }
        .modal-btn {
            background-color: #A0522D;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        .modal-btn:hover {
            background-color: #8b4513;
        }

        /* --- Media Queries para responsividad --- */
        @media (max-width: 600px) {
            .entrada-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .titulo-autor {
                margin-right: 0;
                margin-bottom: 10px;
                min-width: 100%;
            }
            .controles-audio, .controles-compra {
                margin-left: 0;
                width: 100%;
                justify-content: flex-start;
            }
        }

</style>
</head>
<body>

<div class="container">
    <div class="header-links">
        <a href="biblioteca.html" class="back-link">‚Üê Volver a la Biblioteca Principal</a>
        <a href="temas.html" class="temas-btn">Volver a Temas</a>
    </div>

    <h1>Sala Literaria üìö (Orden Alfab√©tico)</h1>
    <p>La lista est√° ordenada alfab√©ticamente por t√≠tulo. Usa el rat√≥n para desplazar la vista r√°pidamente a la deseada.</p>

    <div id="lista-entradas">
        </div>

    <div id="compraModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modal-title"></h2>
            <p id="modal-message"></p>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="closeModal()">Cancelar</button>
                <button class="modal-btn" id="confirmButton">Confirmar Compra</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- CONSTANTES ---
    const ARCHIVO_SALA = "sala-literaria.html";
    const CLAVE_LOCAL = "bibliotecaData";
    // Claves globales de Perfil.html
    const GLOBAL_COINS_KEY = 'totalCoins';
    const GLOBAL_SELECTED_SONGS_KEY = 'selectedSongsGlobal'; 
    // Costos de Compra (Actualizados)
    const CARD_COST = 500; // Costo de compra de carta: 500
    const LYRICS_COST = 50; 

    // --- Funciones de Almacenamiento Global (tomadas de Perfil.html) ---
    function getGlobalCoins() {
        return parseInt(localStorage.getItem(GLOBAL_COINS_KEY) || '0', 10);
    }
    function saveGlobalCoins(coins) {
        localStorage.setItem(GLOBAL_COINS_KEY, coins);
    }
    function getSelectedSongs() {
        try {
            return JSON.parse(localStorage.getItem(GLOBAL_SELECTED_SONGS_KEY) || '[]');
        } catch (e) {
            console.error("Error parsing selected songs from localStorage", e);
            return [];
        }
    }
    function saveSelectedSongs(songs) {
        localStorage.setItem(GLOBAL_SELECTED_SONGS_KEY, JSON.stringify(songs));
    }
    function isCardOwned(title, author, sala) {
        const selectedSongs = getSelectedSongs();
        return selectedSongs.some(song => song.titulo === title && song.autor === author && song.sala === sala);
    }

    // --- L√ìGICA DE LA MODAL ---
    let pendingAction = null; 

    function openModal(title, message, actionCallback) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-message').innerText = message;
        
        // Almacenar la acci√≥n pendiente y configurar el bot√≥n de confirmaci√≥n
        pendingAction = actionCallback;
        document.getElementById('confirmButton').onclick = () => {
            if (pendingAction) {
                pendingAction();
                closeModal();
            }
        };

        document.getElementById('compraModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('compraModal').style.display = 'none';
        pendingAction = null; 
    }

    // Funci√≥n global para cerrar modal si se hace clic fuera
    window.onclick = function(event) {
        const modal = document.getElementById('compraModal');
        if (event.target == modal) {
            closeModal();
        }
    }

    // --- FUNCIONES DE COMPRA ---

    function buyCard(index, cost) {
        const todosLosDatos = inicializarDatos();
        const entradasDeSala = todosLosDatos.filter(d => d.sala === ARCHIVO_SALA).sort((a, b) => a.titulo.localeCompare(b.titulo));
        const song = entradasDeSala[index];

        if (!song) {
            alert("Error: Carta no encontrada.");
            return;
        }
        
        // Comprobar si ya la tiene
        if (isCardOwned(song.titulo, song.autor, song.sala)) {
            alert(`Ya tienes la carta "${song.titulo}" en tu Perfil.`);
            return;
        }

        // Abrir modal de confirmaci√≥n
        const title = "Confirmar Compra de Carta";
        const message = `¬øEst√°s seguro de que quieres comprar la carta "${song.titulo}" de ${song.autor} por ${cost} monedas?`;
        
        openModal(title, message, () => {
            let currentCoins = getGlobalCoins();
            if (currentCoins < cost) {
                alert(`Monedas insuficientes. Necesitas ${cost} monedas.`);
                return;
            }
            
            // 1. Restar monedas
            const newCoins = currentCoins - cost;
            saveGlobalCoins(newCoins);

            // 2. A√±adir al perfil (almacenamiento global)
            const selectedSongs = getSelectedSongs();
            selectedSongs.push({
                titulo: song.titulo,
                autor: song.autor,
                sala: song.sala,
                audioUrl: song.audioUrl 
            });
            saveSelectedSongs(selectedSongs);

            // 3. Confirmar y recargar
            alert(`¬°Compra exitosa! Se han restado ${cost} monedas. La carta "${song.titulo}" ha sido a√±adida a tu Perfil. ¬°Ve a Perfil para gestionarla!`);
            cargarEntradas();
        });
    }

    function buyLyrics(index, cost) {
        let currentCoins = getGlobalCoins();
        if (currentCoins < cost) {
            alert(`Monedas insuficientes. Necesitas ${cost} monedas para descargar las letras.`);
            return;
        }
        
        const todosLosDatos = inicializarDatos();
        const entradasDeSala = todosLosDatos.filter(d => d.sala === ARCHIVO_SALA).sort((a, b) => a.titulo.localeCompare(b.titulo));
        const song = entradasDeSala[index];

        if (!song) {
            alert("Error: Carta no encontrada.");
            return;
        }

        // Abrir modal de confirmaci√≥n
        const title = "Confirmar Compra de Letras";
        const message = `¬øEst√°s seguro de que quieres comprar las letras de "${song.titulo}" por ${cost} monedas?`;
        
        openModal(title, message, () => {
            // 1. Restar monedas
            const newCoins = currentCoins - cost;
            saveGlobalCoins(newCoins);

            // 2. Simular la acci√≥n/confirmar la compra
            alert(`¬°Compra de letras exitosa! Se han restado ${cost} monedas. Ahora tienes acceso a las letras de "${song.titulo}". (En un entorno real, aqu√≠ se iniciar√≠a la descarga o se dar√≠a el link).`);
            cargarEntradas();
        });
    }

    // --- LISTADO BASE Y L√ìGICA DE CARGA ---
    const entradasBase = [
        { titulo: "A una rosa", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/a_una_rosa.mp3", originalObra: "Soneto (Varios autores)" },
        { titulo: "Adolescencia", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/adolescencia.mp3", originalObra: "Poema l√≠rico" },
        { titulo: "Aeroplanos", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/aeroplanos.mp3", originalObra: "Poema" },
        { titulo: "Altazor(Canto IV)", autor: "Vicente Huidobro", sala: ARCHIVO_SALA, audioUrl: "audio/altazor_canto_iv.mp3", originalObra: "Altazor o el viaje en paraca√≠das" },
        { titulo: "Amor constante m√°s all√° de la muerte", autor: "Francisco de Quevedo", sala: ARCHIVO_SALA, audioUrl: "audio/amor_constante.mp3", originalObra: "Poema (Soneto)" },
        { titulo: "Arbol√© arbol√©", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/arbole_arbole.mp3", originalObra: "Poema l√≠rico" },
        { titulo: "Baladas y canciones del Paran√°", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/baladas_parana.mp3", originalObra: "Obra po√©tica" },
        { titulo: "Campos de Castilla(Retrato)", autor: "Antonio Machado", sala: ARCHIVO_SALA, audioUrl: "audio/campos_castilla_retrato.mp3", originalObra: "Campos de Castilla" },
        { titulo: "Canci√≥n para los ojos", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/cancion_ojos.mp3", originalObra: "Poema" },
        { titulo: "Cancion del Pirata", autor: "Jos√© de Espronceda", sala: ARCHIVO_SALA, audioUrl: "audio/cancion_pirata.mp3", originalObra: "Canci√≥n del Pirata (Poema)" },
        { titulo: "C√°ntico", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/cantico.mp3", originalObra: "Obra po√©tica (Varios autores)" },
        { titulo: "Columpio", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/columpio.mp3", originalObra: "Poema" },
        { titulo: "Contra molinos y gigantes", autor: "Cervantes", sala: ARCHIVO_SALA, audioUrl: "audio/molinos-gigantes.mp3", originalObra: "Don Quijote de la Mancha" },
        { titulo: "Coraz√≥n coraza", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/corazon_coraza.mp3", originalObra: "Poema" },
        { titulo: "Don Quijote de la Mancha", autor: "Miguel de Cervantes", sala: ARCHIVO_SALA, audioUrl: "audio/lit_quijote.mp3", originalObra: "El ingenioso hidalgo Don Quijote de la Mancha" },
        { titulo: "El burro flautista(F√°bulas literarias)", autor: "Tom√°s de Iriarte", sala: ARCHIVO_SALA, audioUrl: "audio/burro_flautista.mp3", originalObra: "F√°bulas literarias" },
        { titulo: "El ciclo de Macondo", autor: "Garc√≠a M√°rquez", sala: ARCHIVO_SALA, audioUrl: "audio/macondo.mp3", originalObra: "Cien a√±os de soledad" },
        { titulo: "El lenguaje del mundo", autor: "An√≥nimo", sala: ARCHIVO_SALA, audioUrl: "audio/lenguaje-mundo.mp3", originalObra: "Cuento tradicional" },
        { titulo: "El matrimonio Bennet", autor: "Jane Austen", sala: ARCHIVO_SALA, audioUrl: "audio/bennet.mp3", originalObra: "Orgullo y prejuicio" },
        { titulo: "El ojo que todo lo ve", autor: "George Orwell", sala: ARCHIVO_SALA, audioUrl: "audio/ojo-ve.mp3", originalObra: "1984" },
        { titulo: "El remordimiento", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/el_remordimiento.mp3", originalObra: "Poema" },
        { titulo: "El sol, la playa y la sinceridad", autor: "Albert Camus", sala: ARCHIVO_SALA, audioUrl: "audio/sol-playa.mp3", originalObra: "El extranjero" },
        { titulo: "Eleg√≠a", autor: "Miguel Hernandez", sala: ARCHIVO_SALA, audioUrl: "audio/elegia.mp3", originalObra: "Eleg√≠a a Ram√≥n Sij√©" },
        { titulo: "Freija", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/freija.mp3", originalObra: "Poema l√≠rico" },
        { titulo: "Hija del viento", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/hija_del_viento.mp3", originalObra: "Poema" },
        { titulo: "Historia del caballo de √©bano", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/caballo_ebano.mp3", originalObra: "Las mil y una noches" },
        { titulo: "Ir y quedarse", autor: "Lope de Vega", sala: ARCHIVO_SALA, audioUrl: "audio/ir_y_quedarse.mp3", originalObra: "Soneto LXXXVI" },
        { titulo: "La fiebre de San Persburgo", autor: "Dostoyevski", sala: ARCHIVO_SALA, audioUrl: "audio/san-persburgo.mp3", originalObra: "Crimen y Castigo" },
        { titulo: "La hermanilla", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/la_hermanilla.mp3", originalObra: "Poema" },
        { titulo: "La naturaleza", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/la_naturaleza.mp3", originalObra: "Poema l√≠rico" },
        { titulo: "La patinadora", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/la_patinadora.mp3", originalObra: "Poema" },
        { titulo: "La princesa esta triste", autor: "Rub√©n Dar√≠o", sala: ARCHIVO_SALA, audioUrl: "audio/princesa_triste.mp3", originalObra: "Prosas profanas" },
        { titulo: "La traves√≠a de Odiseo", autor: "Homero", sala: ARCHIVO_SALA, audioUrl: "audio/odiseo.mp3", originalObra: "La Odisea" },
        { titulo: "La voz a t√≠ debida", autor: "Pedro Salinas", sala: ARCHIVO_SALA, audioUrl: "audio/la_voz_a_ti_debida.mp3", originalObra: "La voz a ti debida" },
        { titulo: "Marinero en tierra", autor: "Rafael Alberti", sala: ARCHIVO_SALA, audioUrl: "audio/marinero_tierra.mp3", originalObra: "Marinero en tierra" },
        { titulo: "Marinero en tierra(Sue√±o del marinero)", autor: "Rafael Alberti", sala: ARCHIVO_SALA, audioUrl: "audio/marinero_tierra_sueno.mp3", originalObra: "Marinero en tierra" },
        { titulo: "Memorias de la melancol√≠a", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/memorias_melancolia.mp3", originalObra: "Poema" },
        { titulo: "Pa√≠s", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/pais.mp3", originalObra: "Poema" },
        { titulo: "Piedra de Sol", autor: "Octavio Paz", sala: ARCHIVO_SALA, audioUrl: "audio/piedra_sol.mp3", originalObra: "Piedra de Sol" },
        { titulo: "Poeta en New York(La aurora)", autor: "Federico Garc√≠a Lorca", sala: ARCHIVO_SALA, audioUrl: "audio/poeta_new_york_la_aurora.mp3", originalObra: "Poeta en Nueva York" },
        { titulo: "Por una mirada un mundo", autor: "Gustavo Adolfo B√©cquer", sala: ARCHIVO_SALA, audioUrl: "audio/por_una_mirada.mp3", originalObra: "Rima IV" },
        { titulo: "Residencia en la tierra(Barcarola)", autor: "Pablo Neruda", sala: ARCHIVO_SALA, audioUrl: "audio/residencia_tierra_barcarola.mp3", originalObra: "Residencia en la Tierra" },
        { titulo: "Romance del Duero", autor: "Gerardo Diego", sala: ARCHIVO_SALA, audioUrl: "audio/romance_duero.mp3", originalObra: "Soria" },
        { titulo: "Romancero gitano(Romance de la luna, luna)", autor: "Federico Garc√≠a Lorca", sala: ARCHIVO_SALA, audioUrl: "audio/romancero_gitano_luna.mp3", originalObra: "Romancero gitano" },
        { titulo: "San Baudelio de Berlanga", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/san_baudelio.mp3", originalObra: "Poema" },
        { titulo: "Se equivoc√≥ la paloma", autor: "Rafael Alberti", sala: ARCHIVO_SALA, audioUrl: "audio/se_equivoco_paloma.mp3", originalObra: "Poema" },
        { titulo: "Si el hombre pudiera decir", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/si_el_hombre.mp3", originalObra: "Poema" },
        { titulo: "Trilce", autor: "C√©sar Vallejo", sala: ARCHIVO_SALA, audioUrl: "audio/trilce.mp3", originalObra: "Trilce" },
        { titulo: "Veinte poemas de amor", autor: "Pablo Neruda", sala: ARCHIVO_SALA, audioUrl: "audio/veinte_poemas_amor.mp3", originalObra: "Veinte poemas de amor y una canci√≥n desesperada" },
    ].sort((a, b) => a.titulo.localeCompare(b.titulo));

    function obtenerDatos() {
        const data = localStorage.getItem(CLAVE_LOCAL);
        return data ? JSON.parse(data) : [];
    }

    function guardarDatos(data) {
        localStorage.setItem(CLAVE_LOCAL, JSON.stringify(data));
    }

    // Asegura que los datos de esta sala (y s√≥lo esta) est√©n correctamente sincronizados con el localStorage
    function inicializarDatos() {
        let datos = obtenerDatos();
        let existeCambio = false;

        // 1. Limpiar entradas obsoletas de esta sala
        datos = datos.filter(d => 
            d.sala !== ARCHIVO_SALA || entradasBase.some(base => 
                base.titulo === d.titulo && base.autor === d.autor
            )
        );

        // 2. A√±adir nuevas entradas/actualizar metadatos de esta sala
        entradasBase.forEach(entradaBase => {
            const yaExiste = datos.some(d => 
                d.titulo === entradaBase.titulo && d.autor === entradaBase.autor && d.sala === entradaBase.sala
            );
            
            if (!yaExiste) {
                datos.push(entradaBase);
                existeCambio = true;
            } else {
                // Actualizar posibles campos nuevos como audioUrl u originalObra si no existen
                const index = datos.findIndex(d => d.titulo === entradaBase.titulo && d.autor === entradaBase.autor && d.sala === entradaBase.sala);
                if (index !== -1) {
                    if (datos[index].audioUrl !== entradaBase.audioUrl || datos[index].originalObra !== entradaBase.originalObra) {
                        datos[index].audioUrl = entradaBase.audioUrl;
                        datos[index].originalObra = entradaBase.originalObra; // A√±adido para mantener la consistencia
                        existeCambio = true;
                    }
                }
            }
        });

        if (existeCambio) {
            guardarDatos(datos);
        }
        
        return datos;
    }

    function cargarEntradas() {
        const contenedor = document.getElementById('lista-entradas');
        contenedor.innerHTML = '';
        
        const todosLosDatos = inicializarDatos();
        
        // Filtrar y ordenar las entradas S√ìLO de esta sala
        const entradasDeSala = todosLosDatos.filter(d => d.sala === ARCHIVO_SALA).sort((a, b) => a.titulo.localeCompare(b.titulo));
        
        const currentCoins = getGlobalCoins();

        entradasDeSala.forEach((e, index) => {
            const itemDiv = document.createElement('div');
            itemDiv.setAttribute('data-index-in-data', index);
            itemDiv.className = 'entrada-item';

            const cardOwned = isCardOwned(e.titulo, e.autor, e.sala);
            const buyButtonDisabled = cardOwned || currentCoins < CARD_COST;
            const buyButtonText = cardOwned ? 'En tu Perfil' : `<i class="fas fa-coins"></i> Comprar (${CARD_COST})`;

            const lyricsButtonDisabled = currentCoins < LYRICS_COST;
            const lyricsButtonText = lyricsButtonDisabled ? `<i class="fas fa-coins"></i> Letras (${LYRICS_COST})` : `<i class="fas fa-file-alt"></i> Letras (${LYRICS_COST})`;

            itemDiv.innerHTML = `
                <div class="titulo-autor">
                    <div class="titulo">${e.titulo}</div>
                    <div class="autor">Autor: ${e.autor}</div>
                    ${e.originalObra ? `<div class="original-obra">Basado en: ${e.originalObra}</div>` : ''} </div>
                
                <div class="controles-audio">
                    <audio id="audio-${index}" src="${e.audioUrl}"></audio>
                    <button class="control-btn play-btn" onclick="controlarAudio(${index}, 'play')" title="Reproducir">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn stop-btn" onclick="controlarAudio(${index}, 'stop')" title="Parar">
                        <i class="fas fa-stop"></i>
                    </button>
                </div>
                
                <div class="controles-compra">
                    <button class="buy-btn" 
                        onclick="buyCard(${index}, ${CARD_COST})" 
                        ${buyButtonDisabled ? 'disabled' : ''}
                    >
                        ${buyButtonText}
                    </button>
                    <button class="lyrics-btn" 
                        onclick="buyLyrics(${index}, ${LYRICS_COST})"
                        ${lyricsButtonDisabled ? 'disabled' : ''}
                    >
                        ${lyricsButtonText}
                    </button>
                </div>
            `;
            contenedor.appendChild(itemDiv);
        });
        
        hacerListaArrastrable(); 
    }

    // --- Funci√≥n para hacer la lista arrastrable (SIN REORDENAR) ---
    function hacerListaArrastrable() {
        const lista = document.getElementById('lista-entradas');
        
        // Se mantiene la funcionalidad de Sortable, pero se deshabilita la reordenaci√≥n
        new Sortable(lista, {
            animation: 150,
            disabled: true, 
        });
    }
    
    // --- Funci√≥n de Control de Audio (Se mantiene) ---
    function controlarAudio(index, accion) {
        const audio = document.getElementById(`audio-${index}`);
        
        // Pausar otros audios
        document.querySelectorAll('audio').forEach((a, i) => {
            if (i !== index && !a.paused) {
                a.pause();
                a.currentTime = 0;
            }
        });

        if (accion === 'play') {
            if (audio.paused) {
                audio.play().catch(error => {
                    alert(`Error al reproducir el audio: Comprueba que la URL "${audio.src}" es correcta.`);
                    console.error("Error de reproducci√≥n:", error);
                });
            }
        } else if (accion === 'stop') {
            audio.pause();
            audio.currentTime = 0;
        }
    }

    // Cargar los datos y la lista al iniciar
    window.onload = cargarEntradas;
</script>

</body>
</html>