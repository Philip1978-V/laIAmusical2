<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sala Literaria üìö</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f8f8;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #A0522D;
            text-align: center;
            border-bottom: 2px solid #A0522D;
            padding-bottom: 10px;
        }
        .back-link { 
            display: inline-block; 
            margin-bottom: 20px; 
            text-decoration: none; 
            color: #007bff; 
            font-weight: bold;
        }

        /* --- Estilos para la Lista de Canciones/Cartas --- */
        #lista-entradas {
            padding: 1px 0; 
        }

        .entrada-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px;
            margin: 5px 0;
            border-bottom: 1px solid #eee; 
            cursor: default; 
            background-color: #fff;
            transition: background-color 0.2s;
        }
        .entrada-item:hover {
            background-color: #f7f7f7;
        }
        .titulo-autor {
            flex-grow: 1;
        }
        .titulo {
            font-weight: bold;
            color: #333;
        }
        .autor {
            font-size: 0.9em;
            color: #666;
        }

        /* --- Controles de Audio --- */
        .controles-audio {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }
        audio { display: none; }
        .control-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            font-size: 1.2em;
            color: #A0522D;
            transition: color 0.2s;
        }
        .control-btn:hover {
            color: #D2B48C;
        }

        /* --- Formulario de A√±adir (Modificado) --- */
        .form-section {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fffaf0;
        }
        .form-section input[type="text"] {
            width: 97%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .form-section button {
            background-color: #A0522D;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <a href="biblioteca.html" class="back-link">‚Üê Volver a la Biblioteca Principal</a>
    <h1>Sala Literaria üìö (Orden Alfab√©tico)</h1>
    <p>La lista est√° ordenada alfab√©ticamente por t√≠tulo. Usa el rat√≥n para desplazar la vista r√°pidamente a la deseada.</p>

    <div id="lista-entradas">
        </div>

    <div class="form-section">
        <h2>‚ûï A√±adir Nueva Carta/Canci√≥n Literaria</h2>
        <p style="font-size: 0.9em; color: #888;">*La URL de audio debe ser introducida manualmente en el c√≥digo JavaScript (entrada asignada por defecto).</p>
        <label for="new-titulo">T√≠tulo:</label>
        <input type="text" id="new-titulo" placeholder="Ej: El amor en los tiempos del c√≥lera" required>

        <label for="new-autor">Autor/Fuente:</label>
        <input type="text" id="new-autor" placeholder="Ej: Gabriel Garc√≠a M√°rquez" required>

        <button onclick="agregarEntradaSala()">Guardar y Ordenar</button>
    </div>
</div>

<script>
    const ARCHIVO_SALA = "Sala-literaria.html";
    const CLAVE_LOCAL = "bibliotecaData";
    
    // --- NUEVO LISTADO DE CARTAS/CANCIONES (Ordenadas alfab√©ticamente de forma inicial) ---
    const entradasBase = [
        { titulo: "A una rosa", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/a_una_rosa.mp3" },
        { titulo: "Adolescencia", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/adolescencia.mp3" },
        { titulo: "Aeroplanos", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/aeroplanos.mp3" },
        { titulo: "Altazor(Canto IV)", autor: "Vicente Huidobro", sala: ARCHIVO_SALA, audioUrl: "audio/altazor_canto_iv.mp3" },
        { titulo: "Amor constante m√°s all√° de la muerte", autor: "Francisco de Quevedo", sala: ARCHIVO_SALA, audioUrl: "audio/amor_constante.mp3" },
        { titulo: "Arbol√© arbol√©", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/arbole_arbole.mp3" },
        { titulo: "Baladas y canciones del Paran√°", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/baladas_parana.mp3" },
        { titulo: "Campos de Castilla(Retrato)", autor: "Antonio Machado", sala: ARCHIVO_SALA, audioUrl: "audio/campos_castilla_retrato.mp3" },
        { titulo: "Canci√≥n para los ojos", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/cancion_ojos.mp3" },
        { titulo: "Cancion del Pirata", autor: "Jos√© de Espronceda", sala: ARCHIVO_SALA, audioUrl: "audio/cancion_pirata.mp3" },
        { titulo: "C√°ntico", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/cantico.mp3" },
        { titulo: "Columpio", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/columpio.mp3" },
        { titulo: "Contra molinos y gigantes", autor: "Cervantes", sala: ARCHIVO_SALA, audioUrl: "audio/molinos-gigantes.mp3" },
        { titulo: "Coraz√≥n coraza", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/corazon_coraza.mp3" },
        { titulo: "Don Quijote de la Mancha", autor: "Miguel de Cervantes", sala: ARCHIVO_SALA, audioUrl: "audio/don_quijote.mp3" },
        { titulo: "El burro flautista(F√°bulas literarias)", autor: "Tom√°s de Iriarte", sala: ARCHIVO_SALA, audioUrl: "audio/burro_flautista.mp3" },
        { titulo: "El ciclo de Macondo", autor: "Garc√≠a M√°rquez", sala: ARCHIVO_SALA, audioUrl: "audio/macondo.mp3" },
        { titulo: "El lenguaje del mundo", autor: "An√≥nimo", sala: ARCHIVO_SALA, audioUrl: "audio/lenguaje-mundo.mp3" },
        { titulo: "El matrimonio Bennet", autor: "Jane Austen", sala: ARCHIVO_SALA, audioUrl: "audio/bennet.mp3" },
        { titulo: "El ojo que todo lo ve", autor: "George Orwell", sala: ARCHIVO_SALA, audioUrl: "audio/ojo-ve.mp3" },
        { titulo: "El remordimiento", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/el_remordimiento.mp3" },
        { titulo: "El sol, la playa y la sinceridad", autor: "Albert Camus", sala: ARCHIVO_SALA, audioUrl: "audio/sol-playa.mp3" },
        { titulo: "Eleg√≠a", autor: "Miguel Hernandez", sala: ARCHIVO_SALA, audioUrl: "audio/elegia.mp3" },
        { titulo: "Freija", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/freija.mp3" },
        { titulo: "Hija del viento", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/hija_del_viento.mp3" },
        { titulo: "Historia del caballo de √©bano", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/caballo_ebano.mp3" },
        { titulo: "Ir y quedarse", autor: "Lope de Vega", sala: ARCHIVO_SALA, audioUrl: "audio/ir_y_quedarse.mp3" },
        { titulo: "La fiebre de San Persburgo", autor: "Dostoyevski", sala: ARCHIVO_SALA, audioUrl: "audio/san-persburgo.mp3" },
        { titulo: "La hermanilla", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/la_hermanilla.mp3" },
        { titulo: "La naturaleza", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/la_naturaleza.mp3" },
        { titulo: "La patinadora", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/la_patinadora.mp3" },
        { titulo: "La princesa esta triste", autor: "Rub√©n Dar√≠o", sala: ARCHIVO_SALA, audioUrl: "audio/princesa_triste.mp3" },
        { titulo: "La traves√≠a de Odiseo", autor: "Homero", sala: ARCHIVO_SALA, audioUrl: "audio/odiseo.mp3" },
        { titulo: "La voz a t√≠ debida", autor: "Pedro Salinas", sala: ARCHIVO_SALA, audioUrl: "audio/la_voz_a_ti_debida.mp3" },
        { titulo: "Marinero en tierra", autor: "Rafael Alberti", sala: ARCHIVO_SALA, audioUrl: "audio/marinero_tierra.mp3" },
        { titulo: "Marinero en tierra(Sue√±o del marinero)", autor: "Rafael Alberti", sala: ARCHIVO_SALA, audioUrl: "audio/marinero_tierra_sueno.mp3" },
        { titulo: "Memorias de la melancol√≠a", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/memorias_melancolia.mp3" },
        { titulo: "Pa√≠s", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/pais.mp3" },
        { titulo: "Piedra de Sol", autor: "Octavio Paz", sala: ARCHIVO_SALA, audioUrl: "audio/piedra_sol.mp3" },
        { titulo: "Poeta en New York(La aurora)", autor: "Federico Garc√≠a Lorca", sala: ARCHIVO_SALA, audioUrl: "audio/poeta_new_york_la_aurora.mp3" },
        { titulo: "Por una mirada un mundo", autor: "Gustavo Adolfo B√©cquer", sala: ARCHIVO_SALA, audioUrl: "audio/por_una_mirada.mp3" },
        { titulo: "Residencia en la tierra(Barcarola)", autor: "Pablo Neruda", sala: ARCHIVO_SALA, audioUrl: "audio/residencia_tierra_barcarola.mp3" },
        { titulo: "Romance del Duero", autor: "Gerardo Diego", sala: ARCHIVO_SALA, audioUrl: "audio/romance_duero.mp3" },
        { titulo: "Romancero gitano(Romance de la luna, luna)", autor: "Federico Garc√≠a Lorca", sala: ARCHIVO_SALA, audioUrl: "audio/romancero_gitano_luna.mp3" },
        { titulo: "San Baudelio de Berlanga", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/san_baudelio.mp3" },
        { titulo: "Se equivoc√≥ la paloma", autor: "Rafael Alberti", sala: ARCHIVO_SALA, audioUrl: "audio/se_equivoco_paloma.mp3" },
        { titulo: "Si el hombre pudiera decir", autor: "Desconocido", sala: ARCHIVO_SALA, audioUrl: "audio/si_el_hombre.mp3" },
        { titulo: "Trilce", autor: "C√©sar Vallejo", sala: ARCHIVO_SALA, audioUrl: "audio/trilce.mp3" },
        { titulo: "Veinte poemas de amor", autor: "Pablo Neruda", sala: ARCHIVO_SALA, audioUrl: "audio/veinte_poemas_amor.mp3" },
    ].sort((a, b) => a.titulo.localeCompare(b.titulo)); // Se ordena aqu√≠ para una mejor gesti√≥n de la base.

    // --- Funciones de Almacenamiento Global ---
    function obtenerDatos() {
        const data = localStorage.getItem(CLAVE_LOCAL);
        return data ? JSON.parse(data) : [];
    }

    function guardarDatos(data) {
        localStorage.setItem(CLAVE_LOCAL, JSON.stringify(data));
    }

    // --- Funci√≥n de Inicializaci√≥n y Migraci√≥n (Actualizada) ---
    function inicializarDatos() {
        let datos = obtenerDatos();
        let existeCambio = false;

        // Limpieza: Eliminar entradas que ya no est√°n en la lista base pero tienen la misma sala.
        // Esto simplifica la gesti√≥n de la nueva lista. 
        datos = datos.filter(d => 
            d.sala !== ARCHIVO_SALA || entradasBase.some(base => 
                base.titulo === d.titulo && base.autor === d.autor
            )
        );

        // Asegurarse de que las NUEVAS entradas base existan y tengan audioUrl
        entradasBase.forEach(entradaBase => {
            const yaExiste = datos.some(d => 
                d.titulo === entradaBase.titulo && d.autor === entradaBase.autor && d.sala === entradaBase.sala
            );
            if (!yaExiste) {
                datos.push(entradaBase);
                existeCambio = true;
            }
            // Si ya existe, nos aseguramos de que tenga la URL base (por si se a√±adi√≥ sin ella antes)
            else {
                 const index = datos.findIndex(d => d.titulo === entradaBase.titulo && d.autor === entradaBase.autor && d.sala === entradaBase.sala);
                if (index !== -1 && !datos[index].audioUrl) {
                    datos[index].audioUrl = entradaBase.audioUrl;
                    existeCambio = true;
                }
            }
        });

        if (existeCambio) {
            guardarDatos(datos);
        }
        return datos;
    }

    // --- Funci√≥n para A√±adir Entradas desde el Formulario (URL asignada por defecto) ---
    function agregarEntradaSala() {
        const titulo = document.getElementById('new-titulo').value.trim();
        const autor = document.getElementById('new-autor').value.trim();
        
        if (titulo === "" || autor === "") {
            alert("Por favor, completa el T√≠tulo y el Autor/Fuente.");
            return;
        }
        
        // La URL de audio se asigna a un valor por defecto al no haber campo.
        const audioUrl = "audio/default_nueva_entrada.mp3"; 

        const nuevaEntrada = { titulo, autor, sala: ARCHIVO_SALA, audioUrl };
        let datos = obtenerDatos();
        datos.push(nuevaEntrada);
        guardarDatos(datos);

        document.getElementById('new-titulo').value = '';
        document.getElementById('new-autor').value = '';

        cargarEntradas(); // Recargar la lista, que ahora ordenar√° la nueva entrada
        alert(`"${titulo}" ha sido guardado y ordenado alfab√©ticamente en la Sala Literaria. Recuerda editar el c√≥digo para asignar el audioUrl.`);
    }

    // --- Generaci√≥n de Lista y Controles ---
    function cargarEntradas() {
        const todosLosDatos = inicializarDatos();
        
        // 1. Filtrar solo las entradas de esta sala
        let entradasDeSala = todosLosDatos.filter(d => d.sala === ARCHIVO_SALA);
        
        // 2. ORDENAR alfab√©ticamente por el campo 'titulo'
        entradasDeSala.sort((a, b) => a.titulo.localeCompare(b.titulo));
        
        const contenedor = document.getElementById('lista-entradas');
        contenedor.innerHTML = '';

        if (entradasDeSala.length === 0) {
            contenedor.innerHTML = '<p>No hay cartas/canciones introducidas en esta sala todav√≠a.</p>';
            return;
        }

        // Crear la lista de entradas
        entradasDeSala.forEach((e, index) => {
            const itemDiv = document.createElement('div');
            itemDiv.setAttribute('data-index-in-data', index); 
            itemDiv.className = 'entrada-item';
            
            itemDiv.innerHTML = `
                <div class="titulo-autor">
                    <div class="titulo">${e.titulo}</div>
                    <div class="autor">${e.autor}</div>
                </div>
                
                <div class="controles-audio">
                    <audio id="audio-${index}" src="${e.audioUrl}" preload="auto"></audio>
                    
                    <button class="control-btn play-btn" onclick="controlarAudio(${index}, 'play')" title="Reproducir">
                        ‚ñ∂
                    </button>
                    <button class="control-btn stop-btn" onclick="controlarAudio(${index}, 'stop')" title="Detener">
                        ‚ñ†
                    </button>
                </div>
            `;
            contenedor.appendChild(itemDiv);
        });
        
        // Inicializar Sortable.js solo para el arrastre sin reordenar
        hacerListaArrastrable(); 
    }

    // --- Funci√≥n para hacer la lista arrastrable (SIN REORDENAR) ---
    function hacerListaArrastrable() {
        const lista = document.getElementById('lista-entradas');
        
        new Sortable(lista, {
            animation: 150,
            disabled: true, // Esto evita que el orden se cambie al arrastrar.
        });
    }
    
    // --- Funci√≥n de Control de Audio (Se mantiene) ---
    function controlarAudio(index, accion) {
        // NOTA: Se usa el ID basado en el √≠ndice DOM (audio-0, audio-1, etc.)
        const audio = document.getElementById(`audio-${index}`);
        
        // Detiene otros audios
        document.querySelectorAll('audio').forEach((a, i) => {
            if (i !== index && !a.paused) {
                a.pause();
                a.currentTime = 0;
            }
        });

        if (accion === 'play') {
            if (audio.paused) {
                audio.play().catch(error => {
                    alert(`Error al reproducir el audio: Comprueba que la URL "${audio.src}" es correcta.`);
                    console.error("Error de reproducci√≥n:", error);
                });
            }
        } else if (accion === 'stop') {
            audio.pause();
            audio.currentTime = 0;
        }
    }

    // Cargar los datos y la lista al iniciar la p√°gina
    window.onload = cargarEntradas;
</script>

</body>
</html>